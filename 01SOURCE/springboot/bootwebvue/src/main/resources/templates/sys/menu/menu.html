<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <template th:replace="/base.html"></template>
</head>

<body>
    <div id="app" style="height: 100%;width: 100%;">
        <ll-container style="height: 100%; ">
            <ll-aside width="200px" style="border-right:1px solid #eee;">
                <ll-card class="box-card" style="height:100%;">
                    <div slot="header" class="clearfix">
                        <span class="ll-main-title">菜单树</span>
                    </div>
                    <ll-nav-tree :items="data" :props="defaultProps" :datasource="datasource" accordion @node-click="handleNodeClick">
                    </ll-nav-tree>
                </ll-card>
            </ll-aside>
            <ll-container style="height: 100%; ">
                <ll-header height="40">
                    <ll-card class="box-card">
                        <div slot="header" class="clearfix">
                            <span class="ll-main-span">查询条件</span>
                        </div>
                        <ll-form :model="ruleForm" :status-icon="true" :rules="rules" ref="ruleForm" label-width="100px"
                            style="width:100%">
                            <ll-col :span="8">
                                <ll-form-item label="活动名称" prop="name">
                                    <ll-input v-model="ruleForm.name"></ll-input>
                                </ll-form-item>
                            </ll-col>
                            <ll-col :span="8">
                               <ll-form-item>
                                <ll-button type="primary" size="mini" @click="retrieve">查询</ll-button>
                               </ll-form-item>
                            </ll-col>
                        </ll-form>
                    </ll-card>
                </ll-header>
                <ll-container style="height: 100%; ">
                    <ll-main style="padding: 0 0 0 0px;" style="height: 100%; ">
                        <ll-card class="box-card" style="height:100%;">
                            <div slot="header" class="clearfix">
                                <ll-row>
                                    <ll-col :span="6">
                                        <span class="ll-main-span" style="marign-right:100px;">菜单列表</span>
                                    </ll-col>
                                    <ll-col :span="18">
                                        <ll-button type="primary" icon="el-icon-plus" circle size="mini" style="padding: 3px"
                                            title="添加"></ll-button>
                                        <ll-button type="danger" icon="el-icon-delete" circle size="mini" style="padding: 3px"
                                            title="删除"></ll-button>
                                    </ll-col>
                                </ll-row>
                            </div>
                            <ll-grid :data-wrap="dataWrap" :readonly="true" @current-change="retrieve">
                                <ll-table-column type="selection" width="55">
                                </ll-table-column>
                                </ll-grid-column>
                                <ll-grid-column prop="id" label="菜单标识" :width="180">
                                </ll-grid-column>
                                <ll-grid-column prop="name" label="菜单名称" :width="180">
                                </ll-grid-column>
                                <ll-grid-column prop="sn" label="菜单排序" :width="180">
                                </ll-grid-column>
                                <ll-grid-column prop="link" label="菜单链接" :width="280">
                                </ll-grid-column>
                            </ll-grid>
                        </ll-card>
                    </ll-main>
                </ll-container>
            </ll-container>
        </ll-container>
    </div>

    <script type="text/javascript">
        var dataWrap = ajaxResponse.get("dataWrap");

        var vm = new Vue({
            el: '#app',
            data: {
                dataWrap: dataWrap,
                form: {
                    name: "123"
                },
                datasource: $$pageContextPath + "sys/menu/menu-tree/datalist",
                data: [],
                defaultProps: {
                    children: 'children',
                    label: 'name',
                    isLeaf: 'isLeaf'
                },
                ruleForm: {
                    name: '',
                    region: '',
                    date1: '',
                    date2: '',
                    delivery: false,
                    type: [],
                    resource: '',
                    desc: ''
                },
                rules: {
                    name: [{
                            required: true,
                            message: '请输入活动名称',
                            trigger: 'blur'
                        },
                        {
                            min: 3,
                            max: 5,
                            message: '长度在 3 到 5 个字符',
                            trigger: 'blur'
                        }
                    ],
                    region: [{
                        required: true,
                        message: '请选择活动区域',
                        trigger: 'change'
                    }],
                    date1: [{
                        type: 'date',
                        required: true,
                        message: '请选择日期',
                        trigger: 'change'
                    }],
                    date2: [{
                        type: 'date',
                        required: true,
                        message: '请选择时间',
                        trigger: 'change'
                    }],
                    type: [{
                        type: 'array',
                        required: true,
                        message: '请至少选择一个活动性质',
                        trigger: 'change'
                    }],
                    resource: [{
                        required: true,
                        message: '请选择活动资源',
                        trigger: 'change'
                    }],
                    desc: [{
                        required: true,
                        message: '请填写活动形式',
                        trigger: 'blur'
                    }]
                }
            },
            methods: {
                submitForm(formName) {
                    this.$refs[formName].validate((valid) => {
                        if (valid) {
                            alert('submit!');
                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                },
                resetForm(formName) {
                    this.$refs[formName].resetFields();
                },
                retrieve() {
                    $.request({
                        url: $$pageContextPath + "sys/menu/retrieve",
                        data: {
                        	dataWrap:this.dataWrap
                        },
                        success: function (response) {
                            var dataWrap = response.get("dataWrap");
                            if (dataWrap == null || dataWrap.dataList == null || dataWrap.dataList.length ==
                                0)
                                alert("未查询到任何数据!");
                            vm.$set(vm.$data, "dataWrap", dataWrap);
                        }
                    });
                },
                handleNodeClick(nodeData, node) {
                	$.request({
                        url: $$pageContextPath + "sys/menu/retrieve",
                        type: "POST",
                        contentType: 'application/json;charset=UTF-8',
                        dataType: "json",
                        async: false,
                        data: {
                        	dataWrap:this.dataWrap,
                        	parentId:nodeData.nodeBean.id
                        },
                        success: function (response) {
                            var dataWrap = response.get("dataWrap");
                            if (dataWrap == null || dataWrap.dataList == null || dataWrap.dataList.length ==
                                0)
                                alert("未查询到任何数据!");
                            vm.$set(vm.$data, "dataWrap", dataWrap);
                        }
                    });
                }
            }
        });
    </script>
</body>

</html>